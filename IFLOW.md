# Financial Analysis Project

## 项目概述

这是一个基于AI模型的财务分析工具，专门用于从企业年报中提取财务数据并进行现金流测算分析。项目使用Qwen3-VL-Plus模型处理PDF格式的年报，提取资产负债表、利润表、现金流量表等财务数据，并结合现金流测算方案对企业的现金流状况进行评估。

## 主要功能

- **财务数据提取**：从PDF年报中提取资产负债表、利润表、现金流量表等财务信息
- **现金流测算分析**：基于提取的财务数据，按照现金流测算方案进行分析
- **多公司支持**：可分析不同公司的财务报告，只需传入相应的PDF路径、公司名称和年份
- **指标计算**：计算关键现金流指标，如经营活动现金流(CFO)、自由现金流(FCF)、债务偿还覆盖率(DSCR)等

## 核心文件

### extract_balance_sheet.py
主程序文件，包含以下功能模块：
- `extract_financial_data()`：使用Qwen3-VL-Plus模型提取财务数据
- `perform_cash_flow_analysis()`：使用Qwen3-max模型进行现金流分析
- `cash_flow_analysis()`：完整的现金流分析流程

### 环境配置文件

#### set_key.sh
包含API密钥和基础URL的配置，使用环境变量方式管理。

### 输入文件

#### 财务报告
- `交银金租2024年报.pdf`：交银金融租赁有限责任公司2024年年报
- `中旅国际2024年报（数据加附注）.pdf`：中旅国际2024年报（数据加附注）

#### 方案文档
- `现金流测算方案.docx`：详细的现金流测算方法论和实施方案

### 示例代码
- `ocr_sample.py`：OCR识别示例代码

## 技术栈

- **Python**：主要开发语言
- **OpenAI API**：AI模型接口
- **PyMuPDF (fitz)**：PDF处理
- **PIL**：图像处理
- **Qwen3-VL-Plus**：用于财务数据提取的视觉语言模型
- **Qwen3-Max**：用于现金流分析的大语言模型

## API配置

项目使用环境变量管理API配置：
- `API_KEY`：API密钥
- `BASE_URL`：API基础URL

配置在`set_key.sh`文件中定义，并在Python代码中通过`os.getenv()`获取。

## 现金流测算方案

项目遵循详细的现金流测算方案，包含：

1. **测算目标**：评估企业在未来特定期间内产生和支配现金的能力
2. **数据来源**：三大报表主表（利润表、资产负债表、现金流量表）和财务报表附注
3. **测算方法**：
   - 历史现金流分析（间接法）
   - 未来现金流预测（直接法）
4. **关键指标**：经营活动现金流、自由现金流、债务偿还覆盖率等

## 使用方法

1. **设置环境变量**：运行`source set_key.sh`设置API密钥和基础URL
2. **运行分析**：执行`python extract_balance_sheet.py`进行现金流分析
3. **自定义分析**：调用`cash_flow_analysis(pdf_path, company_name, year)`函数分析其他公司的年报

## 关键算法

### 历史现金流分析（间接法）
```
经营活动现金流（CFO）= 净利润
+ 折旧、摊销、资产减值等非现金费用
– 非经营性收益（如投资收益）
– 营运资本增加（应收↑、存货↑）
+ 营运资本减少（应付↑）
```

### 关键指标计算
- **自由现金流（FCF）**：CFO – 资本性支出
- **债务偿还覆盖率（DSCR）**：（CFO – 必要CAPEX）÷（当期应还本金 + 利息）
- **利息保障倍数**：EBIT ÷ 利息支出
- **现金比率**：（货币资金 + 短期理财）÷ 短期债务

## 注意事项

1. **安全性**：所有API密钥通过环境变量管理，不硬编码在代码中
2. **多公司支持**：代码已参数化，可以分析不同公司的财务报告
3. **全页面扫描**：从PDF的所有页面提取数据，确保不遗漏重要信息
4. **风险控制**：包含附注校准、压力测试、交叉验证等风险控制机制