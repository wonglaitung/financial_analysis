# 财务分析工具

本项目是一个基于AI模型的财务分析工具，专门用于从企业年报中提取财务数据并进行现金流测算分析。

## 功能特性

- **财务数据提取**：从PDF年报中提取资产负债表、利润表、现金流量表等财务信息
- **现金流测算分析**：基于提取的财务数据，按照现金流测算方案进行分析
- **多公司支持**：可分析不同公司的财务报告
- **指标计算**：计算关键现金流指标，如经营活动现金流(CFO)、自由现金流(FCF)、债务偿还覆盖率(DSCR)等

## 技术栈

- Python
- OpenAI API
- PyMuPDF (fitz) - PDF处理
- PIL - 图像处理
- Qwen3-VL-Plus - 用于财务数据提取的视觉语言模型
- Qwen3-Max - 用于现金流分析的大语言模型

## 环境配置

1. 设置API密钥和基础URL：
   ```bash
   source set_key.sh
   ```

2. 确保环境变量`API_KEY`和`BASE_URL`已正确配置

## 使用方法

### 基本用法

直接运行主程序分析默认年报：
```bash
python extract_balance_sheet.py
```

### 自定义分析

分析其他公司的年报：
```python
from extract_balance_sheet import cash_flow_analysis

cash_flow_analysis(
    pdf_path="/path/to/your/company_report.pdf",
    company_name="公司名称",
    year="年份"
)
```

## 核心文件

- `extract_balance_sheet.py` - 主程序文件，包含财务数据提取和现金流分析功能
- `set_key.sh` - API配置文件
- `现金流测算方案.docx` - 现金流测算方法论和实施方案
- `交银金租2024年报.pdf` - 示例财务报告
- `中旅国际2024年报（数据加附注）.pdf` - 示例财务报告

## 现金流测算方案

项目遵循详细的现金流测算方案，包含：

1. **测算目标**：评估企业在未来特定期间内产生和支配现金的能力
2. **数据来源**：三大报表主表和财务报表附注
3. **测算方法**：历史现金流分析（间接法）和未来现金流预测（直接法）
4. **关键指标**：经营活动现金流、自由现金流、债务偿还覆盖率等

## 算法说明

### 历史现金流分析（间接法）
```
经营活动现金流（CFO）= 净利润
+ 折旧、摊销、资产减值等非现金费用
– 非经营性收益（如投资收益）
– 营运资本增加（应收↑、存货↑）
+ 营运资本减少（应付↑）
```

### 关键指标
- **自由现金流（FCF）**：CFO – 资本性支出
- **债务偿还覆盖率（DSCR）**：（CFO – 必要CAPEX）÷（当期应还本金 + 利息）
- **利息保障倍数**：EBIT ÷ 利息支出
- **现金比率**：（货币资金 + 短期理财）÷ 短期债务

## 风险控制

- 附注校准：根据应收账款账龄调整回收率，根据资本承诺补充未来CAPEX
- 压力测试：收入下降10%-20%情景下DSCR是否仍达标
- 交叉验证：比较净利润与经营活动现金流比率，识别利润质量